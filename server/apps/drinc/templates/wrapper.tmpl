#def navigationList
<ul class="nav">
  <li class="active"><a href="home">Home</a></li>
#if $past_deadline
  <li><a href="account">Accounts</a></li>
  <li><a href="analysis">Analysis</a></li>
#end if
</ul>
#end def

#def extra_script_source
#end def

#def extra_script
#end def

#def extra_script_updates
#end def

<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="bootstrap.css" />
    <title>DRINC Prediction Contest</title>
  </head>
  <body>
    <div id="heading" class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <nav class="container">
          <a class="brand" href="#">DRINC Prediction Contest</a>
          $navigationList
        </nav>
      </div>
    </div>
    <div class="row-fluid" style="padding-top: 40px;">
      <div id="stocks" class="span2">
        <table class="table table-condensed table-striped table-hover">
          <thead>
            <tr>
              <th>Ticker</th>
              <th>Price (p)</th>
            </tr>
          </thead>
          <tbody>
            #for $ticker in $tickers
            <tr id="stocks-$ticker.ticker">
              <td>
                <a href="https://www.google.co.uk/finance?q=$ticker.ticker" rel="tooltip" data-placement="right" title="$ticker.full_name">
                  $ticker.ticker
                </a>
              </td>
              <td>$ticker.price</td>
            </tr>
            #end for
          </tbody>
        </table>
      </div>
      <div class="span10">
        <div class="row-fluid">
          $inner
          <div id="standings" class="span3">
            <h2>Standings</h2>
#if $past_deadline
#set hover = 'table-hover'
#else
#set hover = ''
#end if
            <table id="standings-table" class="table table-condensed table-striped $hover">
              <thead>
                <tr>
                  <th>Member</th>
                  <th>Value (&pound;)</th>
                </tr>
              </thead>
              <tbody>
                #for $user in $users
                <tr>
#if $past_deadline
                  <td><a href="account?user=$user.initials">$user.initials</a></td>
#else
                  <td>$user.initials</td>
#end if
                  <td>$user.value</td>
                </tr>
                #end for
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <script src="jquery.js"></script>
    <script src="bootstrap.js"></script>
    $extra_script_source

    <script>
    ## Make rows clickable.
    \$('#stocks tbody tr').click(function() { window.location.href = \$(this).find('a').attr('href'); });
#if $past_deadline
    \$('#standings tbody tr').click(function() { window.location.href = \$(this).find('a').attr('href'); });
#end if

    ## Enable tooltips on the stocks list.
    \$('#stocks a').tooltip();

    ## Page-specific script.
    $extra_script

    ## Automatic updating of stock prices, standings.
    if (typeof(EventSource) !== "undefined") {
      var updates = new EventSource("update_wrapper");
      updates.onmessage = function(e) {
        var data = JSON.parse(e.data);

        for (var i = 0; i < data.stocks.length; i++) {
          var stock = data.stocks[i]
          \$('[id="stocks-'+stock.ticker+'"] td:last').text(stock.price);
        }

        var rows=''
        for (var i = 0; i < data.users.length; i++) {
          var user = data.users[i]
          rows += '<tr>'
#if $past_deadline
          rows += '<td><a href="account?user='+user.initials+'">'+user.initials+'</a></td>'
#else
          rows += '<td>'+'user.initials+'</td>'
#end if
          rows += '<td>'+user.value+'</td>'
          rows += '</tr>'
        }
        \$("#standings-table tbody").html(rows)

        $extra_script_updates
      };
    }
    </script>
  </body>
</html>
